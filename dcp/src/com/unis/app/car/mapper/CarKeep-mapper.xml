<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CarKeepMapper">

	 <resultMap type="CarKeep"     id="resultCarKeep">
	 	<result column="N_XH"      property="n_xh"/>
	 	<result column="N_CLLBXH"  property="n_cllbxh"/>
	 	<result column="C_SXRY"    property="c_sxry"/>
	 	<result column="N_CLXSZLC"    property="n_clxszlc"/>
	 	<result column="D_SQRQ"    property="d_sqrq"/>
	 </resultMap>

	<select id="getCarKeep" parameterType="CarKeep" resultType="CarKeep">
		 SELECT   N_XH      ,
				  N_CLLBXH  ,
				  TO_CHAR(D_SQRQ,'YYYY-MM-DD') D_SQRQ ,
				  C_CLZK    ,
				  N_CLXSZLC ,
				  C_SXRY    ,
				  C_LXFS    ,
				  TO_CHAR(D_DJ,'YYYY-MM-DD') D_DJ ,
				  FUN_GET_CPHMYHZ(N_CLLBXH)  C_YHZID_ ,
				  C_YHZID   ,
				  C_YHID     
		FROM B_CLBY WHERE N_XH = #{n_xh}
	</select>
	
	
	<delete id="deleteCarKeep" parameterType="int">
		DELETE FROM B_CLBY WHERE N_XH = #{n_xh}
	</delete>
	
	<insert id="insertCarKeep" parameterType="hashmap">
		 INSERT INTO B_CLBY(
		      N_XH      ,
			  N_CLLBXH  ,
			  D_SQRQ    ,
			  C_SXRY    ,
			  N_CLXSZLC ,
			  C_CLZK    ,
			  C_LXFS    ,
			  D_DJ      ,
			  C_YHZID   ,
			  C_YHID     ) 
		VALUES (	            	
	          seq_b_clby.nextval,        
              #{n_cllbxh,jdbcType=NUMERIC},  
			  TO_DATE(#{d_sqrq,jdbcType=DATE},'YYYY-MM-DD'),
			  #{c_sxry,jdbcType=VARCHAR}, 
			  #{n_clxszlc,jdbcType=NUMERIC},
			  #{c_clzk,jdbcType=VARCHAR}, 
			  #{c_lxfs,jdbcType=NUMERIC},
			  SYSDATE,
			  #{c_yhzid,jdbcType=VARCHAR}, 
			  #{c_yhid,jdbcType=VARCHAR}
	    )  
	</insert>
	
	<select id="getCarKeepPageList" resultMap="resultCarKeep" parameterType="hashmap">
	SELECT N_XH, N_CLLBXH, C_SXRY, N_CLXSZLC, D_SQRQ
	  FROM (SELECT S.*, ROWNUM RN
	          FROM (SELECT N_XH,
				       FUN_GET_CPHM(N_CLLBXH) N_CLLBXH,
				       C_SXRY,
				       N_CLXSZLC,
				       TO_CHAR(D_SQRQ,'YYYY-MM-DD') D_SQRQ
				  FROM B_CLBY
				  <if test="n_cllbxh != null and n_cllbxh != '' ">
				  	WHERE N_CLLBXH = #{n_cllbxh}
				  </if>
				  ORDER BY N_XH DESC) S
	         WHERE ROWNUM &lt;= #{limit}) T
	 WHERE T.RN &gt; #{start}
	</select>
	
	<select id="getCarKeepPageListCnt" resultType="long" parameterType="hashmap">
		SELECT COUNT(*) Total
		  FROM B_CLBY
		  <if test="n_cllbxh != null and n_cllbxh != '' ">
			WHERE N_CLLBXH = #{n_cllbxh}
		  </if>
	</select>
	
	<update id="updateCarKeep" parameterType="hashmap">
		UPDATE B_CLBY
	      SET N_CLLBXH   =  #{n_cllbxh,jdbcType=NUMERIC},
			  D_SQRQ     =  TO_DATE(#{d_sqrq,jdbcType=DATE},'YYYY-MM-DD'),
			  C_SXRY     =  #{c_sxry,jdbcType=VARCHAR},
			  N_CLXSZLC  =  #{n_clxszlc,jdbcType=NUMERIC},
			  C_LXFS     =  #{c_lxfs,jdbcType=NUMERIC}
		WHERE N_XH = #{n_xh}
	</update>
	
	
</mapper>
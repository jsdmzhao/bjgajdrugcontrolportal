<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CarMapper">

	 <resultMap type="Car"    id="resultCartype">
	 	<result column="N_XH"     property="n_xh"/>
	 	<result column="C_CPHM"   property="c_cphm"/>
	 	<result column="C_YHZID"  property="c_yhzid"/>
	 	<result column="D_DJ"   property="d_dj"/>
	 </resultMap>
	 
	 <resultMap type="Car"    id="resultCar">
	 	<result column="N_XH"     property="n_xh"/>
	 	<result column="N_CLLBXH"   property="n_cllbxh"/>
	 	<result column="C_YHID"   property="c_yhid"/>
	 	<result column="C_SQSY"   property="c_sqsy"/>
	 	<result column="D_CCSJ"   property="d_ccsj"/>
	 	<result column="D_GDSJ"   property="d_gdsj"/>
	 	<result column="C_SHJG"   property="c_shjg"/>
	 	<result column="D_DJ"   property="d_dj"/>
	 </resultMap>
	 
	<select id="getCartype" parameterType="Car" resultType="Car">
		SELECT * FROM B_CLLB WHERE N_XH = #{n_xh}
	</select>
	 
    <select id="getCar" parameterType="Car" resultType="Car">
		SELECT N_XH,
			   N_CLLBXH,
			   FUN_GET_YHMC(C_YHID) C_YHID,
			   C_SQSY,
			   TO_CHAR(D_CCSJ,'YYYY-MM-DD HH24:MI:SS') D_CCSJ,
			   TO_CHAR(D_GDSJ,'YYYY-MM-DD HH24:MI:SS') D_GDSJ
	    FROM B_CLSQ WHERE N_XH = #{n_xh}
	</select>
	 
	<select id="getCarList" resultMap="resultCar" parameterType="hashmap">
		SELECT N_XH,
			   FUN_GET_CPHM(N_CLLBXH) N_CLLBXH,
			   FUN_GET_YHMC(C_YHID) C_YHID,
		       C_SQSY,
		       TO_CHAR(D_CCSJ,'YYYY-MM-DD HH24:MI:SS') D_CCSJ,
		       TO_CHAR(D_GDSJ,'YYYY-MM-DD HH24:MI:SS') D_GDSJ,
		       DECODE(C_SHJG,'1','同意','0','不同意','等待审核') C_SHJG,
		       TO_CHAR(D_DJ,'YYYY-MM-DD HH24:MI:SS') D_DJ
		  FROM B_CLSQ
		  <if test="type != null and type == 'yh' ">
		  WHERE C_YHID = #{c_yhid}
		  </if>
		  ORDER BY N_XH DESC
	</select>
	
	<select id="getCartypeList" resultMap="resultCartype">
		SELECT N_XH,
		       DECODE(C_YHZID,'1','总队领导',
		       		  '3','办公室',
		       		  '4','协调指导大队',
		       		  '9','情报中心',
		       		  '7','侦查大队',
		       		  '8','查禁大队',
		       		  '5','缉控大队',
		       		  '10','两品办')  C_YHZID ,
		       C_CPHM,
		       TO_CHAR(D_DJ,'YYYY-MM-DD HH24:MI:SS') D_DJ
		  FROM B_CLLB
		  ORDER BY N_XH DESC
	</select>
	
	
	<select id="getCartypeCombox" resultType="Combox">
		SELECT N_XH VALUE,
		       C_CPHM TEXT
		  FROM B_CLLB
	</select>
	
	<delete id="deleteCar" parameterType="int">
		DELETE FROM B_CLSQ WHERE N_XH = #{n_xh}
	</delete>
	
	<delete id="deleteCartype" parameterType="int">
		DELETE FROM B_CLLB WHERE N_XH = #{n_xh}
	</delete>
	
	<insert id="insertCar" parameterType="hashmap">
		 INSERT INTO B_CLSQ(
		   N_XH      ,
		   N_CLLBXH  ,
		   C_YHID    ,
		   C_SQSY    ,
		   D_CCSJ    ,
		   D_GDSJ    ,
		   D_DJ    ) 
		VALUES (	            	
	      seq_b_clsq.nextval,        
          #{n_cllbxh,jdbcType=NUMERIC},  
          #{c_yhid,jdbcType=VARCHAR},         
          #{c_sqsy,jdbcType=VARCHAR},           
          TO_DATE(#{d_ccsj,jdbcType=DATE},'YYYY-MM-DD HH24:MI:SS'),           
          TO_DATE(#{d_gdsj,jdbcType=DATE},'YYYY-MM-DD HH24:MI:SS'),           
       	  sysdate      
	    )  
	</insert>
	
	<insert id="insertCartype" parameterType="hashmap">
		INSERT INTO B_CLLB(
		   N_XH    ,
		   C_CPHM  ,
		   C_YHZID ,
		   D_DJ    ) 
		VALUES (	            	
	      seq_b_cllb.nextval,        
          #{c_cphm,jdbcType=VARCHAR}, 
          #{c_yhzid,jdbcType=VARCHAR}, 
       	  sysdate      
	    )  
	</insert>
	
	<update id="updateCar" parameterType="hashmap">
		UPDATE B_CLSQ
		   SET  N_CLLBXH =	#{n_cllbxh,jdbcType=VARCHAR},
		        C_SQSY   =	#{c_sqsy,jdbcType=VARCHAR},
		        D_CCSJ   =	TO_DATE(#{d_ccsj,jdbcType=DATE},'YYYY-MM-DD HH24:MI:SS'),
		   		D_GDSJ   =  TO_DATE(#{d_gdsj,jdbcType=DATE},'YYYY-MM-DD HH24:MI:SS')
		WHERE N_XH = #{n_xh}
	</update>
	
	<update id="operateCar" parameterType="hashmap">
		UPDATE B_CLSQ
		   SET  C_SHJG  =  #{c_shjg,jdbcType=VARCHAR},
		        C_SHR   =  #{c_shr,jdbcType=VARCHAR},
		        D_SHSJ  =  sysdate,
		   		C_SFSH  =  1
		WHERE N_XH = #{n_xh}
	</update>
	
	<update id="updateCartype" parameterType="hashmap">
		UPDATE B_CLLB
		   SET  C_CPHM   =	#{c_cphm,jdbcType=VARCHAR},
		   		C_YHZID  =  #{c_yhzid,jdbcType=VARCHAR}
		WHERE N_XH = #{n_xh}
	</update>
	
	
	
</mapper>